---
layout: post
title: "Auto Layout 约束的优先级"
description: Auto Layout 的权限
date: 2015-06-10 21:15:48
category: 效率开发（学习篇）
---
> 题记：本文根据《iOS AutoLayout 开发秘籍》整理，当然也会包括，我看到的其他资料整理。


##介绍


约束优先级是表示 Auto Layout 考虑各个布局请求的强烈程度的数字。Auto Layout使用优先级解决约束冲突，并决定优先级处理哪条规则。

约束优先级是可读的（有时是可设置的）属性。优先级范围从1（最低优先级）到1000（必需的优先级）。优先级是浮点数。

```
	typedef float UILayoutPriority;
	typedef float NSLayoutPriority; //MAC OS
```


##1.1冲突的优先级

优先级 501 的约束肯定比 优先级500的约束优先处理。假设，你要求一个视图的同时既是30点又是40点高，但是后者有较高的优先级，那么以40点高为标准。

下图是IB中的示例，我给button设置了两个宽的约束 一个是`45`，另一个是`100`。那么我们发现有红色的冲突。代表width的冲突。接着我调整了宽的约束的优先级。`100`的优先级是1000,`45`的优先级被我从1000调成了999。红色冲突消失。


![image](/images/priority/priority01.gif)

那么出了IB中直接的拖控件操作，你也可以通过代码编写。使用NSLayoutConstraint编写。里面有个权限的属性`@property UILayoutPriority priority;`。本文只用IB演示。


##1.2枚举型优先级

----

UIKit中的UIView优先级

----
```
enum {
   UILayoutPriorityRequired  = 1000,
   UILayoutPriorityDefaultHigh  = 750,
   UILayoutPriorityDefaultLow  = 250,
   UILayoutPriorityFittingSizeLevel  = 50,
};
typedef float UILayoutPriority;

```

苹果建议灵活使用优先级，不要使用固定的优先级水平。在使用视图布局系统时，应该将优先级调整的略高或者略低，表示优先级与固定系统值相比的相对次序。

不是说不能将按钮的压缩阻力优先级设置为默认值 750，而是指当创建涉及该按钮的约束时，如果将优先级设置为 751，意思是“比默认压缩阻力更重要”：如果优先级设置为749，则表示“不如默认压缩阻力重要”。

注意：

在运行时更新约束优先级要非常小心，尤其是当优先级的值从必需值变成非必需值时；反之亦然。当一个更新的优先级的角色改变一个安装的约束的效果时，它可能会在运行时抛出异常。

##1.3 内容 吸附优先级 Content Hugging

有两个方向的，水平垂直，具体看我gif图吧。有的控件尺寸是跟随内容的。比如，你设置宽度是 50，而实际内容才20，那么，我想包裹内容。不想有两边的间距。那么让吸附的优先级大于宽的优先级。那么吸附成功了！


![image](/images/xifu.gif)

##1.4 抗压缩 优先级 Compression Resistance

有时候，你设置宽度就是  50，但是你的内容超出了，所以你的文字，就中间就成了 ....，那么怎么办，width的尺寸的优先级小点。让 抗压缩 优先级大点。哪怕是 1000 > 999呢！所以一旦抗压缩成功。内容就可以显示完全了！

![image](/images/yasuo.gif)
=======
![image](/images/priority/xifu.gif)

##1.4 抗压缩 优先级 Compression Resistance


有时候，你设置宽度就是  50，但是你的内容超出了，所以你的文字，就中间就成了 ....，那么怎么办，width的尺寸的优先级小点。让 抗压缩 优先级大点。哪怕是 1000 > 999呢！所以一旦抗压缩成功。内容就可以显示完全了！



![image](/images/priority/yasuo.gif)

我们可以注意到，给哪条约束调整了抗压缩属性。哪条约束就开始显示虚线。

比如说，我 `11111111`的button创建不跟上面那样`上下左`+`固定宽`，而是`上下左右`固定边距的约束，那么我文字越多显示注定不完全，因为我约束告诉button，你就占这么屁股大点的地方。

![image](/images/priority/yasuo00.png)

你没有权限，除非你`申请`。那么，button想：我靠，我要往右移动，给我位置。那么你改变`Trailing`的约束改成`749`就可以了。为啥？因为抗压缩优先级是`750`。这么弄也是为以后有余地调整。你想你搞个`999`，然后抗压缩搞个`1000`。就像上图，这也是可以的。不过没有余量可以调节了，对吧。

![image](/images/priority/yasuo01.png)

这时候button还是不爽，它也要占左边，给自己整了几个字，那么调节`leading`的优先级。

当然你发现，由于右边已经抗压缩了。添加更多的字，更新约束，继续往右边挪动，没有`黄色警告`。

那么我换个思路，修改左边`leading`也为`749`。再添加字体可以吧！

结论：我们是否得出一个结论，一个方向只可以满足一个压缩优先级的约束。如果一个方向，有两个优先级，而且都是 相同的，比如都是`749`。那么发生约束冲突。怎么搞，想娶两个媳妇。法律不允许啊。好吧！我挑个好看的，成不？我选左边的。左边的长得`俊`。

![image](/images/priority/yasuo02.png)

![image](/images/priority/yasuo03.png)

然后，把左边的约束的 `749`改成 `748`。你想抗压缩是`750`。干你`749`都不费劲。干你`748`松松撂倒。那么，button就占了左边的地盘。它很爽！

![image](/images/priority/yasuo04.png)


### 下班了，赶紧回家吃饭，即兴更新，持续更新，想到啥写啥
------

###参考资料：











